name: Ubuntu Desktop (XFCE + Chrome)

on: workflow_dispatch

jobs:
  linux-gacor:
    runs-on: ubuntu-latest
    timeout-minutes: 360 # 6 Jam (1x Multiplier, jadi hemat kuota)
    
    steps:
    - name: 1. Update & Install Desktop (XFCE) ðŸ–¥ï¸
      run: |
        echo ">>> UPDATE REPO..."
        sudo apt-get update
        
        echo ">>> INSTALL XFCE & XRDP (Sabar bentar)..."
        # Install XFCE4 (GUI Ringan) dan XRDP (RDP Server)
        sudo apt-get install -y xfce4 xfce4-goodies xrdp
        
        # Config XRDP biar pake XFCE
        echo xfce4-session > ~/.xsession
        
        # Start Service XRDP
        sudo service xrdp start
        
        echo ">>> DESKTOP SIAP!"

    - name: 2. Setup User & Password ðŸ”‘
      run: |
        # User default GHA itu 'runner'. Kita kasih password biar bisa login RDP.
        # Passwordnya: PasswordSuper123!
        echo "runner:PasswordSuper123!" | sudo chpasswd
        
        # Kasih akses sudo biar lu bisa ngapa-ngapain
        sudo usermod -aG sudo runner
        echo ">>> User 'runner' siap login!"

    - name: 3. Install Google Chrome ðŸŒ
      run: |
        echo ">>> DOWNLOAD CHROME..."
        wget https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb
        sudo dpkg -i google-chrome-stable_current_amd64.deb || sudo apt-get -f install -y
        echo ">>> CHROME TERPASANG!"

    - name: 4. Pasang Cloudflare Tunnel ðŸš‡
      env:
        CF_TOKEN: ${{ secrets.CF_TOKEN }}
      run: |
        # Download Cloudflared versi Linux
        curl -L --output cloudflared.deb https://github.com/cloudflare/cloudflared/releases/latest/download/cloudflared-linux-amd64.deb
        sudo dpkg -i cloudflared.deb
        
        # Jalanin Service
        sudo cloudflared service install $env:CF_TOKEN
        
        echo ">>> TUNNEL MELUNCUR ðŸš€"

    - name: 5. Keep Alive (Looping) ðŸ”„
      run: |
        echo ">>> SYSTEM ONLINE. CONNECT VIA RDP SEKARANG!"
        while true; do
          sleep 60
          echo "Masih hidup bos... $(date)"
        done
