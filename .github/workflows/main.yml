name: Windows Zombie Mode (Edge Only)

on: workflow_dispatch

jobs:
  rdp-brutal:
    runs-on: windows-latest
    timeout-minutes: 360 # 6 Jam Max
    
    steps:
    - name: 1. Setup User & Firewall (Wajib)
      run: |
        net user runneradmin "PasswordSuper123!" 
        Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server' -name "fDenyTSConnections" -value 0
        Enable-NetFirewallRule -DisplayGroup "Remote Desktop"
        Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp' -name "UserAuthentication" -value 1
        Write-Host ">>> Pintu RDP Terbuka." -ForegroundColor Green

    - name: 2. THE PURGE (Hapus Semua Kecuali Edge & System)
      run: |
        Write-Host ">>> MEMULAI PEMBANTAIAN BLOATWARE..." -ForegroundColor Red
        
        # Power Plan Performance biar ngebut pas ngehapus
        powercfg -setactive 8c5e7fda-e8bf-4a96-9a85-a6e23a8c635c

        # Logic: Ambil SEMUA app, Filter yang BUKAN Edge/System, Hapus!
        # Kita exclude UI.Xaml & VCLibs biar Windows Explorer ga crash total.
        Get-AppxPackage -AllUsers | Where-Object { 
            $_.Name -notmatch "Microsoft.MicrosoftEdge" -and 
            $_.Name -notmatch "Microsoft.Windows.SecHealthUI" -and 
            $_.Name -notmatch "Microsoft.UI.Xaml" -and 
            $_.Name -notmatch "Microsoft.VCLibs" -and
            $_.Name -notmatch "Microsoft.NET" 
        } | Remove-AppxPackage -AllUsers -ErrorAction SilentlyContinue

        # Hapus Optional Features (Media Player, Math Recognizer, dll)
        Get-WindowsCapability -Online | Where-Object { $_.State -eq 'Installed' -and $_.Name -notmatch "OpenSSH" } | Remove-WindowsCapability -Online -ErrorAction SilentlyContinue

        Write-Host ">>> SELESAI. TINGGAL TULANG BELULANG SAMA EDGE." -ForegroundColor Yellow

    - name: 3. Pasang Cloudflare Tunnel (Jalan Pintas)
      env:
        CF_TOKEN: ${{ secrets.CF_TOKEN }}
      run: |
        Invoke-WebRequest -Uri https://github.com/cloudflare/cloudflared/releases/latest/download/cloudflared-windows-amd64.exe -OutFile cloudflared.exe
        Start-Process -FilePath ".\cloudflared.exe" -ArgumentList "tunnel --no-autoupdate run --token $env:CF_TOKEN" -NoNewWindow -PassThru
        Write-Host ">>> Tunnel Meluncur ðŸš€" -ForegroundColor Cyan

    - name: 4. Keep Alive (Looping Anti-AFK)
      run: |
        Write-Host ">>> SYSTEM READY. CONNECT SEKARANG!" -ForegroundColor Green
        while ($true) { Start-Sleep -Seconds 60; Write-Host "Masih hidup bang..." }
